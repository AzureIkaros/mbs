"use strict";define(["./index_effect.js","./render.js","jquery","jqcookie"],function(e,t,a){return{init:function(){a("#list").load("session.html"),a("#footer").load("index_footer.html"),a.cookie("url",location.href,{expires:7,path:"/"}),t.cart_render(this.setNum,this.isCheck,this.setCheck),this.clickEvent(),this.checkAll(),this.settleMent(),e.changeHead(),e.logout()},clickEvent:function(){var h=this;a(".good_content").on("click",function(e){if(a(e.target).is(".add")){var t=a(e.target).index(".add");a(".good_num").eq(t).val(+a(".good_num").eq(a(e.target).index(".add")).val()+1),a(".total_price").eq(t).html("￥"+a(".single_price").eq(t).html().replace("￥","")*a(".good_num").eq(t).val()),a(".choose").eq(t).prop("checked",!0),h.setCheck(),h.setNum(),h.changeNum(a(".good_num").eq(t).val(),t)}if(a(e.target).is(".del")){var o=a(e.target).index(".del"),c=+a(".good_num").eq(a(e.target).index(".del")).val()-1;c=c<=0?0:c--,a(".good_num").eq(o).val(c),0!=c?a(".total_price").eq(o).html("￥"+a(".single_price").eq(o).html().replace("￥","")*c):(a(".total_price").eq(o).html(0),a(".choose").eq(o).prop("checked",!1),h.setCheck()),h.setNum(),h.changeNum(a(".good_num").eq(o).val(),o)}if(a(e.target).is(".choose")&&(a(e.target).prop("checked")||a("#allcheck").prop("checked",!1),h.setCheck(),h.setNum()),a(e.target).is(".remove")&&confirm("你确定要删除吗")){var i=a(e.target).index(".remove"),n=a.cookie("color").split(","),r=a.cookie("size").split(","),l=a.cookie("sid").split(","),s=a.cookie("num").split(",");i=h.findIndex(i),n.splice(i,1),r.splice(i,1),l.splice(i,1),s.splice(i,1),a.cookie("num",s,{expires:7,path:"/"}),a.cookie("sid",l,{expires:7,path:"/"}),a.cookie("color",n,{expires:7,path:"/"}),a.cookie("size",r,{expires:7,path:"/"}),a(".shop_content").eq(a(e.target).index(".remove")).remove(),a.each(a(".good_content aside"),function(e,t){0==a(t).children(".shop_content").length&&a(t).remove()}),h.setNum(),h.setCheck(),h.emptyCart()}}),a(".good_content").on("input",function(e){if(a(e.target).is(".good_num")){var t=a(e.target).index(".good_num"),o=a(e.target).val();0!=o?a(".total_price").eq(t).html("￥"+a(".single_price").eq(t).html().replace("￥","")*o):a(".total_price").eq(t).html(0),this.setNum()}})},checkAll:function(){var e=this;a("#allcheck").on("click",function(){a(this).prop("checked")?a(".choose").prop("checked",!0):a(".choose").prop("checked",!1),e.setNum()})},setCheck:function(){var o=!0;o=0!=a(".good_content").children("aside").length,a.each(a(".choose"),function(e,t){if(!a(t).prop("checked"))return o=!1}),o?a("#allcheck").prop("checked",!0):a("#allcheck").prop("checked",!1)},setNum:function(){var c=0,i=0;a.each(a(".choose:checked"),function(e,t){var o=a(".choose").index(t);i+=+a(".good_num").eq(o).val(),c+=+a(".total_price").eq(o).html().replace("￥","")}),0!=i?a(".sum").html("￥"+i):a(".sum").html(0),0!=c?a("#total_price").html("￥"+c):a("#total_price").html(0)},changeNum:function(e,t){var o=a.cookie("num").split(",");o[this.findIndex(t)]=e,a.cookie("num",o,{expires:7,path:"/"})},isCheck:function(){a.each(a(".good_num"),function(e,t){0!=a(this).val()&&a(".choose").eq(e).prop("checked",!0)})},findIndex:function(e){var t=a.cookie("color").split(","),o=a.cookie("size").split(","),c=a(".cColor").eq(e).html().replace("颜色:",""),i=a(".cSize").eq(e).html().replace("尺寸:",""),n=0;return a.each(t,function(e,t){if(c==t&&o[e]==i)return n=e,!1}),n},settleMent:function(){var t=this;a(".deal").on("click",function(e){a(e.target).is(".settle")&&(+a.cookie("flag")?0!=a(".sum").html().replace("￥","")?confirm("您确认要购买选中的商品吗?")&&(alert("购买成功"),a(".good_content aside").remove(),t.setNum(),t.setCheck(),t.emptyCart(),a.cookie("num","",{expires:-1,path:"/"}),a.cookie("color","",{expires:-1,path:"/"}),a.cookie("size","",{expires:-1,path:"/"}),a.cookie("sid","",{expires:-1,path:"/"})):alert("您还没有选择商品哦!请您先选择商品"):confirm("您还没有登录,请先登录")&&(location.href="login.html"))})},emptyCart:function(){0==a(".good_content").children("aside").length&&a(".deal").html("\n                    <p class='empty'>您的购物车空空如也,快去挑选一些商品吧</p>\n                    <a href='http://10.31.155.75/mbs/dist/'>去首页</a>\n                ")}}});